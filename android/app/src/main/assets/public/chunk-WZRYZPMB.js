import{a as N}from"./chunk-RM2XG5VB.js";import{a as F}from"./chunk-3OT5IHQ2.js";import{a as L}from"./chunk-QIL4TVBT.js";import{a as D}from"./chunk-CRPGW2PI.js";import{D as T,O as E}from"./chunk-GK747CHS.js";import"./chunk-ZFIWIRC4.js";import{$b as u,Dc as _,Ia as d,Ja as i,Ka as n,La as g,Lc as O,Pc as k,Qa as p,Rb as y,a as f,ab as c,ac as C,bc as S,cc as w,cd as I,dc as x,ec as b,ed as A,fd as q,hc as M,jc as P,na as m,qa as a,sa as v}from"./chunk-HGIDUMG6.js";import"./chunk-ADY6KXU2.js";import"./chunk-JFHB5KU2.js";import"./chunk-D2WB2TDK.js";import"./chunk-XWSGAIXU.js";import"./chunk-I5IPTR26.js";import"./chunk-4XLORUIW.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{m as l}from"./chunk-DDPKQVXB.js";var Z=(()=>{let s=class s{constructor(e,t,o,r,j,V){this.formBuilder=e,this.router=t,this.authService=o,this.apiService=r,this.commonService=j,this.alertController=V,this.showPassword=!1,this.tokenSubscription=new f,this.loginForm=this.formBuilder.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]]})}ngOnInit(){this.authService.isAuthenticated()&&this.router.navigateByUrl("/home"),this.qrValue=this.generateRandomAlphanumeric(),this.qrLink=`https://ifyoucanmove.com/tvauth/${this.qrValue}?type=signin`,this.addCodeTvAuth(),this.tokenSubscription=this.authService.getTvAuthDataById(this.qrValue).subscribe(e=>{e!=null&&e.token&&(this.commonService.showLoader(),this.loginWithToken(e.token),this.tokenSubscription.unsubscribe())})}loginWithToken(e){return l(this,null,function*(){try{let t=yield this.authService.loginWithCustomToken(e);if(t.user.accessToken){console.log(t,"token");let o={uid:t.user.uid,displayName:t.user.displayName,email:t.user.email,emailVerified:t.user.emailVerified,photoURL:t.user.photoURL},r=JSON.stringify(o);localStorage.setItem("userData",r),localStorage.setItem("uid",t.user.uid),this.router.navigate(["/home"]),this.authService.userData.set(t)}this.commonService.hideLoader()}catch(t){this.commonService.hideLoader(),console.error("Custom token login error:",t)}})}addCodeTvAuth(){return l(this,null,function*(){try{let e=this.authService.addOrUpdateTvAuthQRCollection(this.qrValue,{code:this.qrValue,timestamp:T()})}catch(e){console.log(e,"err")}})}ngOnDestroy(){this.tokenSubscription.unsubscribe()}generateRandomAlphanumeric(){let e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="";for(let o=0;o<6;o++){let r=Math.floor(Math.random()*e.length);t+=e[r]}return t}togglePassword(){this.showPassword=!this.showPassword}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}onSubmit(){return l(this,null,function*(){if(this.loginForm.valid){this.commonService.showLoader();try{let e=yield this.authService.signin(this.loginForm.value.email,this.loginForm.value.password);if(e.user.accessToken){console.log(e);let t={uid:e.user.uid,displayName:e.user.displayName,email:e.user.email,emailVerified:e.user.emailVerified,photoURL:e.user.photoURL},o=JSON.stringify(t);localStorage.setItem("userData",o),localStorage.setItem("uid",e.user.uid),this.router.navigate(["/home"]),this.authService.userData.set(e)}this.commonService.hideLoader()}catch(e){console.log(e,"err"),this.commonService.hideLoader();let t=JSON.stringify(e);t.includes("auth/user-not-found")?(this.errorMessage="Email: "+this.email.value+"   -->   does not exist.",this.showAlert()):t.includes("auth/wrong-password")?(this.errorMessage="Incorrect password. Please try again.",this.showAlert()):t.includes("auth/too-many-requests")?(this.errorMessage="Access to this account has been temporarily disabled due to many failed login attempts. You can immediately restore it by resetting your password or you can try again later",this.showAlert()):t.includes("auth/invalid-email")?(this.errorMessage="The email address is badly formatted.",this.showAlert()):(this.errorMessage="Something went wrong",this.showAlert())}}else this.commonService.showToast("","Email or Password invalid")})}showAlert(){return l(this,null,function*(){let e=yield this.alertController.create({header:"",message:this.errorMessage,buttons:["OK"]});yield e.present(),setTimeout(()=>{e.dismiss()},3e3)})}};s.\u0275fac=function(t){return new(t||s)(a(M),a(y),a(E),a(F),a(D),a(I))},s.\u0275cmp=v({type:s,selectors:[["app-signin"]],decls:30,vars:5,consts:[[1,"sign-in-container"],[1,"sign-in-card"],[1,"qr-section"],[1,"d-flex","align-items-center","justify-content-center",2,"height","370px"],[1,"qrcode","d-flex","justify-content-center"],["size","200","lightColor","#ffff","errorCorrectionLevel","Q",3,"value","margin"],[1,"text-center","text-white","fs-18"],[1,"text-center","mt-1","text-white","fs-14"],[1,"form-section"],[1,"text-center"],["src","../../../assets/images/logo-dark.png","alt","logo",1,"logo",2,"width","150px"],[1,"title"],[3,"ngSubmit","formGroup"],[1,"custom-input"],["name","mail-outline","slot","start"],["formControlName","email","type","email","placeholder","Email",1,"custom-input-field"],["name","lock-closed-outline","slot","start"],["formControlName","password","placeholder","Password",1,"custom-input-field",3,"type"],["slot","end",1,"password-toggle",3,"click","name"],["type","submit","expand","block",1,"sign-in-button"],[1,"forgot-password"],["href","#",1,"forgot-link"]],template:function(t,o){t&1&&(i(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div")(6,"div",4),g(7,"qr-code",5),n(),i(8,"h3",6),c(9,"Use Camera App to Scan QR"),n(),i(10,"h5",7),c(11,"Click on the link generated to redirect to Ifyoucanmove Web App"),n()()()(),i(12,"div",8)(13,"div",9),g(14,"img",10),n(),i(15,"h2",11),c(16,"Sign In"),n(),i(17,"form",12),p("ngSubmit",function(){return o.onSubmit()}),i(18,"ion-item",13),g(19,"ion-icon",14)(20,"ion-input",15),n(),i(21,"ion-item",13),g(22,"ion-icon",16)(23,"ion-input",17),i(24,"ion-icon",18),p("click",function(){return o.togglePassword()}),n()(),i(25,"ion-button",19),c(26," Sign In "),n(),i(27,"div",20)(28,"a",21),c(29,"Forgot Password?"),n()()()()()()()),t&2&&(m(7),d("value",o.qrLink)("margin",1),m(10),d("formGroup",o.loginForm),m(6),d("type",o.showPassword?"text":"password"),m(),d("name",o.showPassword?"eye-off-outline":"eye-outline"))},dependencies:[L,O,_,k,q,A,w,C,S,x,b,N,P],styles:['.sign-in-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:var(--background-primary);background-image:url("./media/membershipicon-2JIOD3E5.webp");background-size:contain;background-repeat:no-repeat;background-position:bottom}.sign-in-card[_ngcontent-%COMP%]{display:flex;background:#1f1f1fe0;border-radius:var(--border-radius);overflow:hidden;box-shadow:0 8px 32px #0000004d;max-width:900px;width:100%}.qr-section[_ngcontent-%COMP%]{flex:1;background:#0003;padding:30px;display:flex;align-items:center;justify-content:center;border-right:1px solid rgba(255,255,255,.1)}.qr-section[_ngcontent-%COMP%]   .qr-container[_ngcontent-%COMP%]{text-align:center}.qr-section[_ngcontent-%COMP%]   .qr-container[_ngcontent-%COMP%]   .qr-text[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:16px;margin:0}.form-section[_ngcontent-%COMP%]{flex:1;padding:30px}.form-section[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--text-primary);text-align:center;margin-bottom:10px;margin-top:10px;font-size:28px}.form-section[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]{--background: transparent;--border-color: rgba(255, 255, 255, .1);--highlight-color-focused: var(--accent-primary);margin-bottom:20px;border-radius:var(--border-radius);overflow:hidden}.form-section[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:20px}.form-section[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]   .custom-input-field[_ngcontent-%COMP%]{--color: var(--text-primary);--placeholder-color: var(--text-secondary)}.form-section[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]   .password-toggle[_ngcontent-%COMP%]{cursor:pointer;color:var(--text-secondary)}.form-section[_ngcontent-%COMP%]   .custom-input[_ngcontent-%COMP%]   .password-toggle[_ngcontent-%COMP%]:hover{color:var(--accent-primary)}.form-section[_ngcontent-%COMP%]   .sign-in-button[_ngcontent-%COMP%]{--background: linear-gradient( to right, var(--accent-primary), var(--accent-secondary) );--background-activated: linear-gradient( to right, var(--accent-secondary), var(--accent-primary) );--color: var(--text-primary);margin-top:30px;height:48px;font-weight:600;text-transform:none}.form-section[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.form-section[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]   .forgot-link[_ngcontent-%COMP%]{color:var(--text-secondary);text-decoration:none;font-size:14px}.form-section[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]   .forgot-link[_ngcontent-%COMP%]:hover{color:var(--accent-primary)}@media (max-width: 768px){.sign-in-card[_ngcontent-%COMP%]{flex-direction:column}.qr-section[_ngcontent-%COMP%]{border-right:none;border-bottom:1px solid rgba(255,255,255,.1);padding:20px}.form-section[_ngcontent-%COMP%]{padding:20px}}']});let h=s;return h})();export{Z as SigninPage};
