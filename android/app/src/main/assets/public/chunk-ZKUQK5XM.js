import{a as q}from"./chunk-OTUILQOT.js";import{a as H,b as J}from"./chunk-PILLEFZM.js";import{a as Y}from"./chunk-BHVEF5NT.js";import"./chunk-MGRSP4XQ.js";import"./chunk-RM2XG5VB.js";import{a as U}from"./chunk-GUCCS5WG.js";import{a as R}from"./chunk-3OT5IHQ2.js";import{a as B}from"./chunk-QIL4TVBT.js";import{a as G}from"./chunk-CRPGW2PI.js";import{O as z}from"./chunk-GK747CHS.js";import"./chunk-ZFIWIRC4.js";import{Bb as M,Ca as v,Cb as T,Da as C,Hb as W,Ia as w,Ja as n,Ka as r,Kc as L,La as f,Mc as F,Ob as A,Pa as _,Qa as u,Ra as d,Rb as E,Sc as O,U as g,V as p,ab as h,ad as j,bb as I,cb as S,ed as N,kb as P,na as c,qa as m,sa as V,wa as k}from"./chunk-HGIDUMG6.js";import"./chunk-ADY6KXU2.js";import"./chunk-JFHB5KU2.js";import"./chunk-D2WB2TDK.js";import"./chunk-XWSGAIXU.js";import"./chunk-I5IPTR26.js";import"./chunk-4XLORUIW.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{m as b}from"./chunk-DDPKQVXB.js";var X=o=>({"background-image":o});function Z(o,l){if(o&1){let a=_();n(0,"button",13),u("click",function(){g(a);let e=d(2);return p(e.openMoodTracker())}),f(1,"ion-icon",14),n(2,"span"),h(3,"Mark as Complete"),r()()}}function $(o,l){if(o&1&&(n(0,"span"),h(1),r()),o&2){let a=d(3);c(),S("(",a.getDayWatchCount(a.videoData.day),")")}}function ee(o,l){if(o&1){let a=_();n(0,"button",13),u("click",function(){g(a);let e=d(2);return p(e.openMoodTracker())}),f(1,"ion-icon",15),n(2,"span",16),h(3,"Completed "),k(4,$,2,1,"span",17),r()()}if(o&2){let a=d(2);c(4),w("ngIf",a.getDayWatchCount(a.videoData.day)>1)}}function te(o,l){if(o&1){let a=_();n(0,"button",13),u("click",function(){g(a);let e=d(2);return p(e.openMoodList(e.videoData.day))}),n(1,"span"),h(2,"\u{1F60A}"),r()()}}function ie(o,l){if(o&1){let a=_();n(0,"button",13),u("click",function(){g(a);let e=d(2);return p(e.addTofav())}),f(1,"ion-icon",18),n(2,"span"),h(3,"Add to Favorites"),r()()}}function ae(o,l){if(o&1){let a=_();n(0,"button",13),u("click",function(){g(a);let e=d(2);return p(e.removeFromFavList())}),f(1,"ion-icon",19),n(2,"span"),h(3,"Added to Favorites"),r()()}}function oe(o,l){if(o&1){let a=_();f(0,"div",3)(1,"div",4),n(2,"div",5)(3,"div",6)(4,"h1"),h(5),r(),n(6,"div",7),h(7),r(),n(8,"div",8)(9,"button",9),u("click",function(){g(a);let e=d();return p(e.onVideoOpen(e.videoData))}),f(10,"ion-icon",10),n(11,"span"),h(12,"Play"),r()()(),n(13,"div",11),v(14,Z,4,0,"button",12),v(15,ee,5,1,"button",12),v(16,te,3,0,"button",12),v(17,ie,4,0,"button",12),v(18,ae,4,0,"button",12),r()()()}if(o&2){let a=d();w("ngStyle",P(8,X,"url("+a.videoData.image+")")),c(5),I(a.challengeName),c(2),S(" Duration: ",a.videoData.durationMinutes," Mins "),c(7),C(a.isDayVideoWatched(a.videoData.day)?-1:14),c(),C(a.isDayVideoWatched(a.videoData.day)?15:-1),c(),C(a.checkMoodIconVisible(a.videoData.day)?16:-1),c(),C(a.checkFavorites()?-1:17),c(),C(a.checkFavorites()?18:-1)}}var fe=(()=>{let l=class l{constructor(t,e,i,s,D,K,Q){this.viewportScroller=t,this.route=e,this.router=i,this.authService=s,this.apiService=D,this.modalCtrl=K,this.commonService=Q,this.challenges=[],this.watchData=[],this.lastWatched=[],this.isCompleted=!1,this.isLoading=!0,this.favList=[];let x=this.router.getCurrentNavigation();if(console.log(x,"navigation"),x!=null&&x.extras.state){let y=x.extras.state;this.videoData=y.data,this.challengeId=y.challengeId,this.challengeName=y.challengeName,console.log(y,"ss")}}ngOnInit(){window.scrollTo(0,0),this.viewportScroller.scrollToPosition([0,0]),this.getFavList();let t=this.authService.customer();t&&(this.status=t.status,t||(this.status=""),this.status!=="active"&&(this.status="inactive")),this.commonService.loader=!0,this.authService.customer().challengeData[this.challengeId]?this.repeatCount=this.authService.customer().challengeData[this.challengeId].repeatCount:this.repeatCount=0,console.log(this.authService.customer(),"cu",this.repeatCount),this.route.params.subscribe(e=>{this.videoId=e.id,this.loadVideo()})}ngAfterViewInit(){setTimeout(()=>{console.log("ngAfterViewInit");let t=document.getElementById("play-btn");t&&t.focus()},2e3)}ionViewDidEnter(){setTimeout(()=>{console.log("ionViewDidEnter");let t=document.getElementById("play-btn");t&&t.focus()},3e3)}loadVideo(){this.apiService.getChallengeList().subscribe(t=>{this.challenges=t.challenges.map(e=>({id:e.id,image:e.dashBannerUrl,title:e.dashTitle,duration:"20"}))}),this.loadWatchData()}loadWatchData(){let t={repeatCount:this.repeatCount,userId:this.authService.userObjData.email,challengeId:this.challengeId,day:this.videoData.day};this.apiService.geWatchCompletedDataOfChallenge(t).subscribe(e=>{console.log(e),this.watchData=e,this.getLastWatched(this.watchData),this.isLoading=!1,this.commonService.loader=!1},e=>{this.isLoading=!1,this.commonService.loader=!1})}getLastWatched(t){let e=t.filter(i=>i.day===String(this.videoData.day));e.length>1&&e.sort((i,s)=>i.date-s.date),this.lastWatched=e}isDayVideoWatched(t){return this.watchData.filter(i=>i.day===String(t)).length>0}openMoodTracker(){return b(this,null,function*(){let t=yield this.modalCtrl.create({component:H,cssClass:"mood-tracker-modal",componentProps:{data:null}});yield t.present();let{data:e}=yield t.onWillDismiss();e&&(console.log("Selected mood:",e),this.saveMarkAsComplete(e))})}saveMarkAsComplete(t){var i;this.isCompleted=this.isDayVideoWatched(this.videoData.day);let e={category:"challenge",isCompletedEmails:(i=this.authService.customer().isCompletedEmails)!=null?i:!1,energyData:t,userId:this.authService.userObjData.email,title:this.challengeName,durationMinutes:this.videoData.durationMinutes,watchCount:this.isCompleted?this.getMaxWatchCount()+1:1,repeatCount:this.repeatCount,isEnergyDataAvailable:!!t,challengeId:this.challengeId,day:this.videoData.day};console.log(e),this.isCompleted?this.openDialog(e):this.apiService.markAsComplete(e).subscribe(s=>{s&&this.loadWatchData()})}getMaxWatchCount(){return this.watchData?this.watchData.length:0}onVideoOpen(t){return b(this,null,function*(){let e={title:t.title1,image:t.image,videoId:t.id,video:t.url,description:""};try{yield(yield this.modalCtrl.create({component:q,componentProps:{video:e},cssClass:"video-player-modal",showBackdrop:!0,backdropDismiss:!0})).present()}catch(i){console.error("Error opening video modal:",i)}})}onViewAllChallenges(){this.router.navigate(["/challenge-list"])}onCardChallenges(t){this.router.navigate(["/challenge-detail/",t.id])}openDialog(t){return b(this,null,function*(){let e=yield this.modalCtrl.create({component:U,componentProps:{title:"Confirm Action",message:"Are you sure you want to mark this video as complete again?",confirmText:"Yes",cancelText:"No"},cssClass:"confirm-modal"});yield e.present();let{data:i}=yield e.onWillDismiss();i&&(console.log("Selected:",i),this.apiService.markAsComplete(t).subscribe(s=>{console.log(s),this.loadWatchData()}))})}getDayWatchCount(t){var i;let e=this.watchData.filter(s=>s.day===String(t));return(i=e==null?void 0:e.length)!=null?i:0}checkMoodIconVisible(t){return this.watchData&&this.watchData.length?this.watchData.filter(i=>i.day===t).length>0:!1}openMoodList(t){return b(this,null,function*(){let e=this.watchData.filter(D=>D.day==t),i=yield this.modalCtrl.create({component:J,componentProps:{data:e},cssClass:"mood-list-dialog"});yield i.present();let{data:s}=yield i.onWillDismiss();s&&this.loadWatchData()})}getFavList(){this.apiService.getFavorites(this.authService.userObjData.email).subscribe(t=>{console.log(t,"favlist"),this.favList=t.favorites;let e=this.favList.find(i=>i.postId===this.challengeId+":"+this.videoData.day);e&&(this.favDocid=e.docid),console.log(this.favDocid,"this.favDocid ")})}addTofav(){let t={postId:this.challengeId+":"+this.videoData.day,day:this.videoData.day,challengeId:this.challengeId,email:this.authService.userObjData.email,title:this.challengeName+" : Day "+this.videoData.day,image:this.videoData.image,type:"challenge",durationMinutes:this.videoData.durationMinutes};this.apiService.addFavorites(t).subscribe(e=>{console.log(e),this.getFavList()})}removeFromFavList(){console.log(this.favDocid),this.apiService.deleteFavorites(this.favDocid).subscribe(t=>{this.getFavList()})}checkFavorites(){let t=this.favList;if(t)return t&&t.filter(e=>e.postId===this.challengeId+":"+this.videoData.day).length}};l.\u0275fac=function(e){return new(e||l)(m(W),m(A),m(E),m(z),m(R),m(j),m(G))},l.\u0275cmp=V({type:l,selectors:[["app-challenge-video-details"]],decls:5,vars:5,consts:[[1,"mt-3"],["size","12"],[3,"viewAllClick","videoClick","status","isDetailPage","videos","title"],[1,"hero-background",2,"position","fixed",3,"ngStyle"],[1,"hero-overlay"],[1,"hero-content"],[1,"hero-title"],[1,"hero-description"],[1,"hero-actions"],["id","play-btn","tabindex","0",1,"btn-icon-primary","ion",3,"click"],["name","play","slot","start"],[1,"d-flex","gap-2","mt-3","flex-wrap"],["tabindex","0",1,"btn-icon-primary"],["tabindex","0",1,"btn-icon-primary",3,"click"],["name","checkmark-circle-outline"],["name","checkmark-done-circle-outline"],[1,"me-2"],[4,"ngIf"],["name","heart-outline"],["name","heart"]],template:function(e,i){e&1&&(v(0,oe,19,10),n(1,"ion-grid",0)(2,"ion-row")(3,"ion-col",1)(4,"app-video-section",2),u("viewAllClick",function(){return i.onViewAllChallenges()})("videoClick",function(D){return i.onCardChallenges(D)}),r()()()()),e&2&&(C(i.videoData?0:-1),c(4),w("status",i.status)("isDetailPage",!0)("videos",i.challenges)("title","Top Challenges"))},dependencies:[B,L,F,O,N,M,T,Y],styles:[".hero-background[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;background-size:contain;background-repeat:no-repeat;background-position:top;filter:brightness(.4) blur(0px);z-index:1}.hero-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:-100px;background:linear-gradient(to top,#000 20%,#0003);z-index:1}.hero-content[_ngcontent-%COMP%]{position:relative;z-index:3;display:flex;align-items:flex-start;padding-left:1vw;padding-top:0}.hero-title[_ngcontent-%COMP%]{max-width:500px;color:#fff}.hero-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:1rem}.hero-description[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:2rem;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.7)}.hero-actions[_ngcontent-%COMP%]   .ion[_ngcontent-%COMP%]{margin-right:1rem;font-size:1.5rem}"]});let o=l;return o})();export{fe as ChallengeVideoDetailsPage};
