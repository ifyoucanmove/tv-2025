import{E as _,G as b,H as u,J as B,K as U,L as v,M as d,N as n,O as K,P as F}from"./chunk-GK747CHS.js";import{J as i,Jb as y,L as f,O as D,P as h,Rb as I,b as $,l as c}from"./chunk-HGIDUMG6.js";import{a as m,m as C}from"./chunk-DDPKQVXB.js";var O=(()=>{let o=class o{constructor(e){this.authService=e,this.router=h(I),this.http=h(y),this.apiBaseUrl=F.apiBaseUrl,this.firestore=h(_),this.cache=new Map,this.DEFAULT_CACHE_TTL=5*60*1e3}getCachedData(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<t.ttl?t.data:(t&&this.cache.delete(e),null)}setCachedData(e,t,s=this.DEFAULT_CACHE_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}clearCache(e){this.cache.delete(e)}clearAllCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}clearCompletionCaches(e){e.programId&&this.clearCache(`completionSeries_${e.userId}_${e.programId}_${e.repeatCount||0}`),e.category&&e.postId&&this.clearCache(`completionWorkout_${e.userId}_${e.category}_${e.postId}`),e.category&&e.comboId&&this.clearCache(`completionByo_${e.userId}_${e.category}_${e.comboId}`),e.challengeId&&e.day&&this.clearCache(`watchChallenge_${e.challengeId}_${e.day}_${e.userId}_${e.repeatCount||0}`),e.challengeId&&e.category&&this.clearCache(`watchCoolDownWarmUp_${e.challengeId}_${e.userId}_${e.category}`)}clearFavoritesCache(e){this.clearCache(`favorites_${e}`)}clearAllCompletionCaches(){let e=[];this.cache.forEach((t,s)=>{(s.startsWith("completion")||s.startsWith("watch"))&&e.push(s)}),e.forEach(t=>this.cache.delete(t))}clearAllFavoritesCaches(){let e=[];this.cache.forEach((t,s)=>{s.startsWith("favorites_")&&e.push(s)}),e.forEach(t=>this.cache.delete(t))}getProgrammList(){let e="programmList",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/list.json").pipe(i(s=>this.setCachedData(e,s)))}getByoList(){let e="byoList",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/byo.json").pipe(i(s=>this.setCachedData(e,s)))}getComboFeed(){let e="comboFeed",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/combo-feed.json").pipe(i(s=>this.setCachedData(e,s)))}getMyCombo(){let e="myCombo",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/my-combo.json").pipe(i(s=>this.setCachedData(e,s)))}getComboFeedDetails(){let e="comboFeedDetails",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/combo-feed-details.json").pipe(i(s=>this.setCachedData(e,s)))}getFitnessDashboardDetails(){let e="fitnessDashboardDetails",t=this.getCachedData(e);return t?c(t):this.http.get("assets/jsons/fitness-dashboard-details.json").pipe(i(s=>this.setCachedData(e,s)))}getChallengeList(){let e="challengeList",t=this.getCachedData(e);return t?c(t):this.http.get(`${this.apiBaseUrl}/challenges`).pipe(i(s=>this.setCachedData(e,s)))}getChallengeDetails(e){let t=`challengeDetails_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/challenges/${e}/days`).pipe(i(a=>this.setCachedData(t,a)))}getCategoriesList(){let e="categoriesList",t=this.getCachedData(e);return t?c(t):this.http.get(`${this.apiBaseUrl}/categories`).pipe(i(s=>this.setCachedData(e,s)))}getPostByCategory(e){let t=`postByCategory_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/posts-by-category?category=${e}`).pipe(i(a=>this.setCachedData(t,a)))}getProgramItems(e){let t=`programItems_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/program-items?programId=${e}`).pipe(i(a=>this.setCachedData(t,a)))}getFitnessList(){let e="fitnessList",t=this.getCachedData(e);return t?c(t):this.http.get(`${this.apiBaseUrl}/programs`).pipe(i(s=>this.setCachedData(e,s)))}getWorkoutList(){let e="workoutList",t=this.getCachedData(e);return t?c(t):this.http.get(`${this.apiBaseUrl}/programs`).pipe(i(s=>this.setCachedData(e,s)))}getComboDetails(e){let t=`comboDetails_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/byo-combo-details?id=${e}`).pipe(i(a=>this.setCachedData(t,a)))}getUserMadeCombo(e,t){let s=`userMadeCombo_${e}_${t}`,a=this.getCachedData(s);return a?c(a):this.http.get(`${this.apiBaseUrl}/byo-combos?type=${e}&uid=${t}`).pipe(i(r=>this.setCachedData(s,r)))}getPreMadeCombo(){let e="preMadeCombo",t=this.getCachedData(e);return t?c(t):this.http.get(`${this.apiBaseUrl}/admin-byo-combos`).pipe(i(s=>this.setCachedData(e,s)))}loadCompletedData(e,t){let s=u(this.firestore,"completed"),a=d(s,n("userId","==",e),v("date","asc"),B(t));return b(a,{idField:"id"})}getMystatsData(e,t,s){let a=`mystats_${s}_${e}_${t}`,r=this.getCachedData(a);return r?c(r):this.http.get(`https://us-central1-ifyoucanmove-dev.cloudfunctions.net/mystats?userId=${s}&fromDate=${e}&toDate=${t}`).pipe(i(l=>this.setCachedData(a,l,2*60*1e3)))}geCompletetionDataOfSeries(e){let t=`completionSeries_${e.userId}_${e.programId}_${e.repeatCount}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/completion-status?userId=${e.userId}&programId=${e.programId}&repeatCount=${e.repeatCount}`).pipe(i(a=>this.setCachedData(t,a,1*60*1e3)))}geCompletetionDataOfWorkout(e){let t=`completionWorkout_${e.userId}_${e.category}_${e.postId}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/completion-status?userId=${e.userId}&category=${e.category}&postId=${e.postId}`).pipe(i(a=>this.setCachedData(t,a,1*60*1e3)))}geCompletetionDataOfByo(e){let t=`completionByo_${e.userId}_${e.category}_${e.comboId}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/completion-status?userId=${e.userId}&category=${e.category}&comboId=${e.comboId}`).pipe(i(a=>this.setCachedData(t,a,1*60*1e3)))}geWatchCompletedDataOfChallenge(e){let t=`watchChallenge_${e.challengeId}_${e.day}_${e.userId}_${e.repeatCount}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/completion-status?challengeId=${e.challengeId}&day=${e.day}&userId=${e.userId}&repeatCount=${e.repeatCount}`).pipe(i(a=>this.setCachedData(t,a,1*60*1e3)))}geWatchCompletedDataOfCoolDownOrWarmUp(e){let t=`watchCoolDownWarmUp_${e.challengeId}_${e.userId}_${e.category}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/completion-status?challengeId=${e.challengeId}&userId=${e.userId}&category=${e.category}`).pipe(i(a=>this.setCachedData(t,a,1*60*1e3)))}markAsComplete(e){return this.clearCompletionCaches(e),this.http.post(`${this.apiBaseUrl}/mark-as-complete`,e)}updateMarkAsComplete(e,t){return this.clearCompletionCaches(t),this.http.put(`${this.apiBaseUrl}/mark-as-complete/${e}`,t)}deleteMarkAsComplete(e){return this.clearAllCompletionCaches(),this.http.delete(`${this.apiBaseUrl}/mark-as-complete/${e}`)}addFavorites(e){return e.email&&this.clearFavoritesCache(e.email),this.http.post(`${this.apiBaseUrl}/favorites`,e)}deleteFavorites(e){return this.clearAllFavoritesCaches(),this.http.delete(`${this.apiBaseUrl}/favorites/${e}`)}getFavorites(e){let t=`favorites_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/favorites?email=${e}`).pipe(i(a=>this.setCachedData(t,a,2*60*1e3)))}getSubscriptionData(){return C(this,null,function*(){if(console.log(this.authService.customer()),this.authService.customer().subscription_id){let e;this.authService.customer()._isPaddleBillingV2?e="https://us-central1-ifyoucanmove-dev.cloudfunctions.net/paddleUserGetBySubscriptionIdV2":e="https://us-central1-ifyoucanmove-dev.cloudfunctions.net/paddleUserGetBySubscriptionId",this.http.post(e,{subscription_id:this.authService.customer().subscription_id}).subscribe({next:t=>(this.subscriptionData=t.response[0],this.subscriptionData),error:t=>{}})}})}getSubscriptionCancellationData(){let e=u(this.firestore,"functions_webhooks","Stripe","subscription_cancelled"),t=d(e,n("_subscription_id","==",this.authService.customer().subscription_id),n("_email","==",this.authService.customer().email));return new $(s=>{let a=U(t,r=>{let l=r.docs.map(g=>m({id:g.id},g.data()));s.next(l)},r=>{s.error(r)});return()=>a()})}getPostById(e){let t=`postById_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/post?id=${e}`).pipe(i(a=>this.setCachedData(t,a)))}searchContent(e){let t=`search_${e}`,s=this.getCachedData(t);return s?c(s):this.http.get(`${this.apiBaseUrl}/search?q=${encodeURIComponent(e)}`).pipe(i(a=>this.setCachedData(t,a,2*60*1e3)))}};o.\u0275fac=function(t){return new(t||o)(D(K))},o.\u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"});let p=o;return p})();export{O as a};
